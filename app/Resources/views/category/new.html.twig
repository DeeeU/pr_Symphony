{% extends 'base.html.twig' %}

{% block title %}新規カテゴリ作成{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-container {
            max-width: 600px;
            margin: 0 auto;
        }
        .form-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #007bff;
        }
        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: inline-block;
            margin-left: 10px;
        }
        .help-text {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="container mt-4">
        <div class="form-container">
            <!-- ページヘッダー -->
            <div class="form-header">
                <h1><i class="fas fa-plus-circle text-primary mr-2"></i>新規カテゴリ作成</h1>
                <p class="text-muted mb-0">メモを整理するためのカテゴリを作成しましょう</p>
            </div>

            <!-- フラッシュメッセージ -->
            {% for message in app.flashes('error') %}
                <div class="alert alert-danger alert-dismissible fade show">
                    <i class="fas fa-exclamation-circle mr-2"></i>{{ message }}
                    <button type="button" class="close" data-dismiss="alert">
                        <span>&times;</span>
                    </button>
                </div>
            {% endfor %}

            <!-- フォーム -->
            <div class="form-section">
                {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}

                <!-- カテゴリ名 -->
                <div class="form-group">
                    {{ form_label(form.name, null, {'label_attr': {'class': 'font-weight-bold'}}) }}
                    {{ form_widget(form.name, {'attr': {'class': 'form-control form-control-lg', 'placeholder': 'カテゴリ名を入力してください（例: 仕事、プライベート、学習）'}}) }}
                    {{ form_errors(form.name) }}
                    <div class="help-text">
                        <i class="fas fa-info-circle mr-1"></i>
                        最大100文字まで入力可能です
                    </div>
                </div>

                <!-- 説明 -->
                <div class="form-group">
                    {{ form_label(form.description, null, {'label_attr': {'class': 'font-weight-bold'}}) }}
                    {{ form_widget(form.description, {'attr': {'class': 'form-control', 'placeholder': 'カテゴリの説明を入力してください（任意）', 'rows': 4}}) }}
                    {{ form_errors(form.description) }}
                    <div class="help-text">
                        <i class="fas fa-info-circle mr-1"></i>
                        このカテゴリの用途や内容について説明してください（任意）
                    </div>
                </div>

                <!-- プレビューエリア -->
                <div class="form-group">
                    <label class="font-weight-bold">プレビュー</label>
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <span id="colorPreview" class="color-preview" style="background-color: #007bff;"></span>
                                <div class="ml-3">
                                    <h6 class="mb-1" id="namePreview">カテゴリ名がここに表示されます</h6>
                                    <small class="text-muted" id="descriptionPreview">説明がここに表示されます</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="help-text">
                        <i class="fas fa-eye mr-1"></i>
                        入力内容のプレビューです
                    </div>
                </div>

                <!-- 送信ボタン -->
                <div class="form-group text-center">
                    {{ form_widget(form.save, {'attr': {'class': 'btn btn-primary btn-lg px-5'}}) }}
                    <a href="{{ path('category_index') }}" class="btn btn-secondary btn-lg px-4 ml-2">
                        <i class="fas fa-times mr-1"></i>キャンセル
                    </a>
                </div>

                {{ form_end(form) }}
            </div>

            <!-- ヒント -->
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <i class="fas fa-lightbulb mr-2"></i>カテゴリ作成のヒント
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li><strong>用途別</strong>: 仕事、プライベート、学習、買い物</li>
                        <li><strong>プロジェクト別</strong>: プロジェクトA、新商品開発、引っ越し準備</li>
                        <li><strong>優先度別</strong>: 重要、普通、後回し</li>
                        <li><strong>期間別</strong>: 今日、今週、来月</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function() {
            // リアルタイムプレビュー機能
            function updatePreview() {
                var name = $('#appbundle_category_name').val() || 'カテゴリ名がここに表示されます';
                var description = $('#appbundle_category_description').val() || '説明がここに表示されます';

                $('#namePreview').text(name);
                $('#descriptionPreview').text(description);
            }

            // 入力時にプレビュー更新
            $('#appbundle_category_name, #appbundle_category_description').on('input', updatePreview);

            // フォームバリデーション強化
            $('form').on('submit', function(e) {
                var name = $('#appbundle_category_name').val().trim();

                if (name.length === 0) {
                    e.preventDefault();
                    alert('カテゴリ名は必須です');
                    $('#appbundle_category_name').focus();
                    return false;
                }

                if (name.length > 100) {
                    e.preventDefault();
                    alert('カテゴリ名は100文字以内で入力してください');
                    $('#appbundle_category_name').focus();
                    return false;
                }
            });

            // 入力フィールドのフォーカス効果
            $('.form-control').on('focus', function() {
                $(this).parent().addClass('focused');
            }).on('blur', function() {
                $(this).parent().removeClass('focused');
            });
        });
    </script>
{% endblock %}
